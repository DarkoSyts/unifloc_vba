'=======================================================================================
'Unifloc 7.17  Test                                     khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2019
'
'=======================================================================================
'PVT UDF  (user defined functions for PVT calculation)
Option Explicit
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' функция расчета всех pvt свойств
Public Function PVT_all_pvt( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "" _
            ) ' VFM
' обязательные аргументы функции
' p_atma    давление, атм
' Т_C       температура, С.
'
' опциональные аргументы функции
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' Возвращает значение объемного коэффициента газа, м3/м3
' для заданных термобарических условий.
' В основе расчета корреляция для z факотора
'description_end
        
On Error GoTo err1:
    Dim PVT As CPVT
    Dim i As Integer
    Dim ar1, ar2, arr
    Dim res As New Dictionary
    Dim p_b_atm As Variant
    
    p_b_atm = PVT_pb_atma( _
                 t_C, _
          gamma_gas, _
          gamma_oil, _
          gamma_wat, _
          rsb_m3m3, _
          rp_m3m3, _
          pb_atma, _
          tres_C, _
          bob_m3m3, _
          muob_cP, _
          PVTcorr, _
          ksep_fr, _
          p_ksep_atma, _
          t_ksep_C, _
          str_PVT)
          
          
    Const arr_len = 23
    ReDim ar1(22)
    ReDim ar2(22)
    ReDim arr(1, 22)
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    res.Add "pb_atma", p_b_atm
    res.Add "bg_m3m3", PVT.bg_m3m3
    res.Add "bo_m3m3", PVT.bo_m3m3
    res.Add "bw_m3m3", PVT.bw_m3m3
     res.Add "bob_m3m3", PVT.bob_m3m3
    res.Add "z", PVT.z
    res.Add "mu_oil_cP", PVT.mu_oil_cP
    res.Add "mu_wat_cP", PVT.mu_wat_cP
    res.Add "mu_gas_cP", PVT.mu_gas_cP
    res.Add "mu_deadoil_cP", PVT.mu_deadoil_cP
    res.Add "muob_cP", PVT.muob_cP
    res.Add "rho_oil_rc_kgm3", PVT.rho_oil_rc_kgm3
    res.Add "rho_wat_rc_kgm3", PVT.rho_wat_rc_kgm3
    res.Add "rho_gas_rc_kgm3", PVT.rho_gas_rc_kgm3
    
    res.Add "sigma_oil_gas_Nm", PVT.sigma_oil_gas_Nm
    res.Add "sigma_wat_gas_Nm", PVT.sigma_wat_gas_Nm
    
    
    res.Add "rs_m3m3", PVT.rs_m3m3
    res.Add "rsb_m3m3", PVT.rsb_m3m3
    res.Add "sal_ppm", PVT.sal_ppm
    
    res.Add "cg_JkgC", PVT.cg_JkgC
    res.Add "co_JkgC", PVT.co_JkgC
    res.Add "cw_JkgC", PVT.cw_JkgC
    
    res.Add "compressibility_oil_1atm", PVT.compressibility_oil_1atm
    
    
    
    
    For i = 1 To arr_len
        ar1(i - 1) = res.Items()(i - 1)
        ar2(i - 1) = res.Keys()(i - 1)
    Next i
    
    For i = LBound(ar1) To UBound(ar1)
            arr(0, i) = ar1(i)
            arr(1, i) = ar2(i)
        Next i
    
    PVT_all_pvt = arr
    Exit Function
err1:
    PVT_all_pvt = -1
    addLogMsg "Error:PVT_all_pvt:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' функция расчета объемного коэффициента газа
Public Function PVT_bg_m3m3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' Возвращает значение объемного коэффициента газа, м3/м3
' для заданных термобарических условий.
' В основе расчета корреляция для z факотора
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_bg_m3m3 = PVT.bg_m3m3
    Exit Function
err1:
    PVT_bg_m3m3 = -1
    addLogMsg "Error:PVT_bg_m3m3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет объемного коэффициента нефти
Public Function PVT_bo_m3m3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает значение объемного коэффициента нефти, м3/м3
' для заданных термобарических условий.
' В основе расчета корреляции PVT
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_bo_m3m3 = PVT.bo_m3m3
    Exit Function
err1:
    PVT_bo_m3m3 = -1
    addLogMsg "Error:PVT_bo_m3m3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет объемного коэффициента воды
Public Function PVT_bw_m3m3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает значение объемного коэффициента воды, м3/м3
' для заданных термобарических условий.
' В основе расчета корреляции PVT
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_bw_m3m3 = PVT.bw_m3m3
    Exit Function
err1:
    PVT_bw_m3m3 = -1
    addLogMsg "Error:PVT_bw_m3m3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет солености воды
Public Function PVT_salinity_ppm( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает соленость воды, ppm
' для заданных термобарических условий.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_salinity_ppm = PVT.sal_ppm
    Exit Function
err1:
    PVT_salinity_ppm = -1
    addLogMsg "Error:PVT_salinity_ppm:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет вязкости нефти
Public Function PVT_mu_oil_cP( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - вязкость нефти
'           при заданных термобарических условиях, сП
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_mu_oil_cP = PVT.mu_oil_cP
    Exit Function
err1:
    PVT_mu_oil_cP = -1
    addLogMsg "Error:PVT_mu_oil_cP:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет вязкости газа
Public Function PVT_mu_gas_cP( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - вязкость газа
'           при заданных термобарических условиях, сП
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_mu_gas_cP = PVT.mu_gas_cP
    Exit Function
err1:
    PVT_mu_gas_cP = -1
    addLogMsg "Error:PVT_mu_gas_cP:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет вязкости воды
Public Function PVT_mu_wat_cP( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - вязкость воды
'           при заданных термобарических условиях, сП
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_mu_wat_cP = PVT.mu_wat_cP
    Exit Function
err1:
    PVT_mu_wat_cP = -1
    addLogMsg "Error:PVT_mu_wat_cP:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет газосодержания
Public Function PVT_rs_m3m3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - газосодержание при
'           заданных термобарических условиях, м3/м3.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_rs_m3m3 = PVT.rs_m3m3
    Exit Function
err1:
    PVT_rs_m3m3 = -1
    addLogMsg "Error:PVT_Rs_m3m3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет коэффициента сверхсжимаемости газа
Public Function PVT_z( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - z фактор газа.
'           коэффициент сверхсжимаемости газа,
'           безразмерная величина
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_z = PVT.z
    Exit Function
err1:
    PVT_z = -1
    addLogMsg "Error:PVT_Z:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет плотности нефти в рабочих условиях
Public Function PVT_rho_oil_kgm3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - плотность нефти
'           при заданных термобарических условиях, кг/м3.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_rho_oil_kgm3 = PVT.rho_oil_rc_kgm3
    Exit Function
err1:
    PVT_rho_oil_kgm3 = -1
    addLogMsg "Error:PVT_rho_oil_kgm3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет плотности газа в рабочих условиях
Public Function PVT_rho_gas_kgm3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - плотность газа
'           при заданных термобарических условиях, кг/м3.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_rho_gas_kgm3 = PVT.rho_gas_rc_kgm3
    Exit Function
err1:
    PVT_rho_gas_kgm3 = -1
    addLogMsg "Error:PVT_rho_gas_kgm3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет плотности воды в рабочих условиях
Public Function PVT_rho_wat_kgm3( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - плотность воды
'           при заданных термобарических условиях, кг/м3.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_rho_wat_kgm3 = PVT.rho_wat_rc_kgm3
    Exit Function
err1:
    PVT_rho_wat_kgm3 = -1
    addLogMsg "Error:PVT_rho_wat_kgm3:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' Расчет давления насыщения
Public Function PVT_pb_atma( _
                 ByVal t_C As Double, _
        Optional ByVal gamma_gas As Double = const_gg_, _
        Optional ByVal gamma_oil As Double = const_go_, _
        Optional ByVal gamma_wat As Double = const_gw_, _
        Optional ByVal rsb_m3m3 = const_rsb_default, _
        Optional ByVal rp_m3m3 = -1, _
        Optional ByVal pb_atma = -1, _
        Optional ByVal tres_C = const_tres_default, _
        Optional ByVal bob_m3m3 = -1, _
        Optional ByVal muob_cP = -1, _
        Optional ByVal PVTcorr = Standing_based, _
        Optional ByVal ksep_fr = 0, _
        Optional ByVal p_ksep_atma = -1, _
        Optional ByVal t_ksep_C = -1, _
        Optional ByVal str_PVT As String = "")
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число - давление насыщения.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    PVT_pb_atma = PVT.calc_pb_atma(rsb_m3m3, t_C)
    Exit Function
err1:
    PVT_pb_atma = -1
    addLogMsg "Error:PVT_pb_atma:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет коэффициента поверхностного натяжения нефть - газ
Public Function PVT_ST_oilgas_Nm( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает коэффициента поверхностного натяжения нефть - газ, Нм
' для заданных термобарических условий.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_ST_oilgas_Nm = PVT.sigma_oil_gas_Nm
    Exit Function
err1:
    PVT_ST_oilgas_Nm = -1
    addLogMsg "Error:PVT_ST_oilgas_Nm:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет коэффициента поверхностного натяжения вода - газ
Public Function PVT_ST_watgas_Nm( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает коэффициента поверхностного натяжения вода - газ, Нм
' для заданных термобарических условий.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_ST_watgas_Nm = PVT.sigma_wat_gas_Nm
    Exit Function
err1:
    PVT_ST_watgas_Nm = -1
    addLogMsg "Error:PVT_ST_watgas_Nm:" & Err.Description
End Function
'description_to_manual      - для автогенерации описания - помещает заголовок функции и окружающие комментарии в мануал (со след строки)
' расчет коэффициента поверхностного натяжения жидкость - газ
Public Function PVT_ST_liqgas_Nm( _
            ByVal p_atma As Double, _
            ByVal t_C As Double, _
            Optional ByVal gamma_gas As Double = const_gg_, _
            Optional ByVal gamma_oil As Double = const_go_, _
            Optional ByVal gamma_wat As Double = const_gw_, _
            Optional ByVal rsb_m3m3 = const_rsb_default, _
            Optional ByVal rp_m3m3 = -1, _
            Optional ByVal pb_atma = -1, _
            Optional ByVal tres_C = const_tres_default, _
            Optional ByVal bob_m3m3 = -1, _
            Optional ByVal muob_cP = -1, _
            Optional ByVal PVTcorr = Standing_based, _
            Optional ByVal ksep_fr = 0, _
            Optional ByVal p_ksep_atma = -1, _
            Optional ByVal t_ksep_C = -1, _
            Optional ByVal str_PVT As String = "")
' p_atma    давление, атм
' t_C       температура, С.
' gamma_gas удельная плотность газа, по воздуху.
'           const_gg_ = 0.6
' gamma_oil удельная плотность нефти, по воде.
'           const_go_ = 0.86
' gamma_wat удельная плотность воды, по воде.
'           const_gw_ = 1
' rsb_m3m3  газосодержание при давлении насыщения, м3/м3.
'           const_rsb_default = 100
' rp_m3m3   замерной газовый фактор, м3/м3.
'           имеет приоритет перед rsb если Rp < rsb
' pb_atma   Давление насыщения при  температуре tres_C, атма.
'           Опциональный калибровочный параметр,
'           если не задан или = 0 то рассчитается по корреляции
' tres_C    пластовая температура, С.
'           Учитывается при расчете давления насыщения.
'           const_tres_default = 90
' bob_m3m3  объемный коэффициент нефти, м3/м3.
' muob_cP   вязкость нефти при давлении насыщения
'           По умолчанию рассчитывается по корреляции
' PVTcorr   номер набора PVT корреляций для расчета
'           Standing_based = 0 - на основе кор-ии Стендинга
'           McCain_based = 1 - на основе кор-ии Маккейна
'           straigth_line = 2 - на основе упрощенных зависимостей
' ksep_fr   коэффициент сепарации - определяет изменение свойств
'           нефти после сепарации доли свободного газа.
'           изменение свойств нефти зависит от условий
'           сепарации газа, которые должны быть явно заданы
' p_ksep_atma    давление при которой была сепарация
' t_ksep_C       температура при которой была сепарация
' str_PVT    закодированная строка с параметрами PVT.
'           если задана - перекрывает другие значения
'
' результат - число
' Возвращает коэффициента поверхностного натяжения жидкость - газ, Нм
' для заданных термобарических условий.
'description_end
On Error GoTo err1:
    Dim PVT As CPVT
    Set PVT = readPVT(gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, rp_m3m3, pb_atma, tres_C, bob_m3m3, _
                    muob_cP, PVTcorr, ksep_fr, p_ksep_atma, t_ksep_C, str_PVT)
    Call PVT.calc_PVT(p_atma, t_C)
    PVT_ST_liqgas_Nm = PVT.sigma_liq_Nm
    Exit Function
err1:
    PVT_ST_liqgas_Nm = -1
    addLogMsg "Error:PVT_ST_liqgas_Nm:" & Err.Description
End Function
' функция вывода номера версии унифлок для расчетных модулей
Public Function getUFVersion()
    getUFVersion = const_unifloc_version
End Function
' вспомогательная функция для создания PVT объекта из исходных данных
Private Function readPVT(Optional ByVal gamma_gas As Double = const_gg_, _
                    Optional ByVal gamma_oil As Double = const_go_, _
                    Optional ByVal gamma_wat As Double = const_gw_, _
                    Optional ByVal rsb_m3m3 = const_rsb_default, _
                    Optional ByVal rp_m3m3 = -1, _
                    Optional ByVal pb_atma = -1, _
                    Optional ByVal tres_C = const_tres_default, _
                    Optional ByVal bob_m3m3 = -1, _
                    Optional ByVal muob_cP = -1, _
                    Optional ByVal PVTcorr = Standing_based, _
                    Optional ByVal ksep_fr = 0, _
                    Optional ByVal p_ksep_atma = -1, _
                    Optional ByVal t_ksep_C = -1, _
                    Optional ByVal str_PVT As String = "" _
                    ) As CPVT
    Dim PVT As CPVT
    If str_PVT <> "" Then
        Set PVT = PVT_decode_string(str_PVT)
    Else
        Set PVT = New CPVT
        PVT.Init gamma_gas, gamma_oil, gamma_wat, rsb_m3m3, pb_atma, bob_m3m3, PVTcorr, tres_C, rp_m3m3, muob_cP
        If ksep_fr > 0 And ksep_fr <= 1 And p_ksep_atma > 0 And t_ksep_C > 0 Then
            Call PVT.mod_after_separation(p_ksep_atma, t_ksep_C, ksep_fr, GasGoesIntoSolution)
        End If
    End If
    Set readPVT = PVT
End Function

